<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Htaccess on Henrique Dias</title>
    <link>http://localhost:1313/tags/htaccess/</link>
    <description>Recent content in Htaccess on Henrique Dias</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 14 Aug 2014 10:41:38 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/htaccess/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Guardar os erros do PHP num ficheiro com o .htaccess</title>
      <link>http://localhost:1313/tutorials/guardar-os-erros-php-num-ficheiro-com-o-htaccess</link>
      <pubDate>Thu, 14 Aug 2014 10:41:38 +0000</pubDate>
      
      <guid>http://localhost:1313/tutorials/guardar-os-erros-php-num-ficheiro-com-o-htaccess</guid>
      <description>&lt;p&gt;Quando os programadores de soluções web estão a programar alguma aplicação é normal que possam surgir erros durante o desenvolvimento e a linguagem de programação, por norma, mostra-os no browser.&lt;/p&gt;

&lt;p&gt;Mesmo depois do desenvolvimento concluído e do produto lançado, podem surgir erros porém é pouco profissional mostrar os erros &amp;ldquo;à paisana&amp;rdquo; no browser do utilizador sendo até uma boa &amp;ldquo;ajuda&amp;rdquo; para hackers.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://localhost:1313/images/phperros.jpg&#34; alt=&#34;Guardar os erros do PHP num ficheiro com o .htaccess&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Hoje vamos explicar como podemos utilizar o ficheiro &lt;code&gt;.htaccess&lt;/code&gt; para fazer o registo em log (&lt;em&gt;logging&lt;/em&gt;) dos erros dados pela linguagem de programação PHP num ficheiro.&lt;/p&gt;

&lt;p&gt;Como devem ter previsto, o único ficheiro que é necessário modificar é o &lt;code&gt;.htaccess&lt;/code&gt;. Vamos começar por definir algumas &lt;code&gt;php_flags&lt;/code&gt; de forma a não mostrar nenhum erro ao utilizador.&lt;/p&gt;

&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span class=&#34;c&#34;&gt;# Não mostra erros de inicialização&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; display_startup_errors &lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;
&lt;span class=&#34;c&#34;&gt;# Não mostra os restantes erros&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; display_errors &lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;
&lt;span class=&#34;c&#34;&gt;# Não mostra erros de markup HTML&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; html_errors &lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;O código acima, e o restante, está comentado para saber o que faz cada linha. Agora, depois de termos desativado os erros &amp;ldquo;ao público&amp;rdquo;, vamos fazer com que estes sejam guardados num ficheiro.&lt;/p&gt;

&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span class=&#34;c&#34;&gt;# Ativa o registo em log dos erros&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; log_errors &lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;
&lt;span class=&#34;c&#34;&gt;# Desativa a ignoração a erros repetidos&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; ignore_repeated_errors &lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;
&lt;span class=&#34;c&#34;&gt;# Desativa &amp;quot;Ignorar erros de fonte única&amp;quot;&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; ignore_repeated_source &lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;
&lt;span class=&#34;c&#34;&gt;# Ativa log de vazamentos de memória do php&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; report_memleaks &lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;
&lt;span class=&#34;c&#34;&gt;# Preserva os erros mais recentes&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; track_errors &lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;
&lt;span class=&#34;c&#34;&gt;# Desativa a formatação de erros com links de referência&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_value&lt;/span&gt; docref_root &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_value&lt;/span&gt; docref_ext &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;c&#34;&gt;# Especifica um caminho para o ficheiro de log&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_value&lt;/span&gt; error_log &lt;span class=&#34;sx&#34;&gt;/home/error.log&lt;/span&gt;

&lt;span class=&#34;c&#34;&gt;# Especifica para guardar todos os erros&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_value&lt;/span&gt; error_reporting -1
&lt;span class=&#34;c&#34;&gt;# Desativa o tamanho máximo de erros&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_value&lt;/span&gt; log_errors_max_len &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Agora os erros já estão a ser guardados num ficheiro de log, mas continua a existir um problema. Se acedermos ao URL onde está guardado, vamos poder aceder ao ficheiro.&lt;/p&gt;

&lt;p&gt;Isto pode ser utilizado como arma por qualquer pessoa, nomeadamente por &lt;em&gt;hackers&lt;/em&gt;. Vamos então proteger o ficheiro de forma a que o público não lhe tenha acesso.&lt;/p&gt;

&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span class=&#34;c&#34;&gt;# Proteger o ficheiro&lt;/span&gt;
&lt;span class=&#34;nt&#34;&gt;&amp;lt;Files&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;error.log&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
 &lt;span class=&#34;nb&#34;&gt;Order&lt;/span&gt; allow,deny
 &lt;span class=&#34;nb&#34;&gt;Deny&lt;/span&gt; from &lt;span class=&#34;k&#34;&gt;all&lt;/span&gt;
 &lt;span class=&#34;nb&#34;&gt;Satisfy&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;All&lt;/span&gt;
&lt;span class=&#34;nt&#34;&gt;&amp;lt;/Files&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Não se esqueçam de colocar o nome do ficheiro correto substituindo &lt;code&gt;error.log&lt;/code&gt; pelo nome que querem. Alerto também para alterarem o caminho &lt;code&gt;/home/error.log&lt;/code&gt; para o caminho em questão. Aqui está o código completo sem qualquer comentário, excelente para ser utilizado:&lt;/p&gt;

&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; display_startup_errors &lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; display_errors &lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; html_errors &lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; log_errors &lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; ignore_repeated_errors &lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; ignore_repeated_source &lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; report_memleaks &lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_flag&lt;/span&gt; track_errors &lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_value&lt;/span&gt; docref_root &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_value&lt;/span&gt; docref_ext &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_value&lt;/span&gt; error_log &lt;span class=&#34;sx&#34;&gt;/home/error.log&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;php_value&lt;/span&gt; error_reporting -1
&lt;span class=&#34;nb&#34;&gt;php_value&lt;/span&gt; log_errors_max_len &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;

&lt;span class=&#34;nt&#34;&gt;&amp;lt;Files&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;error.log&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
 &lt;span class=&#34;nb&#34;&gt;Order&lt;/span&gt; allow,deny
 &lt;span class=&#34;nb&#34;&gt;Deny&lt;/span&gt; from &lt;span class=&#34;k&#34;&gt;all&lt;/span&gt;
 &lt;span class=&#34;nb&#34;&gt;Satisfy&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;All&lt;/span&gt;
&lt;span class=&#34;nt&#34;&gt;&amp;lt;/Files&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Depois de fazerem as edições no caminho e nome do ficheiro, basta guardarem o vosso .htaccess  e verificam que os erros produzidos pelo PHP irão ser salvos no ficheiro em questão.&lt;/p&gt;

&lt;p&gt;Acrescento que, a qualquer momento, pode utilizar a função &lt;code&gt;error_log(&#39;Erro aqui&#39;)&lt;/code&gt; do PHP para enviar um erro para o log.&lt;/p&gt;

&lt;p&gt;Espero que este artigo vos tenha ajudado :)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Edição:&lt;/strong&gt; Tal como o leitor António mencionou, isto apenas funciona caso o PHP tenha o &lt;a href=&#34;http://support.tigertech.net/php-value&#34;&gt;módulo do Apache ativo. &lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
